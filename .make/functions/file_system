# Determines whether the given path exists and is a directory.
# Only existing directories contain a "." entry.
#
# Arguments:
#   $(1) = path to check
#
# Returns:
#   whether $(1) refers to an existing directory
#
# References:
#   MadScientist's answer:
#     http://stackoverflow.com/a/9456282/512904
#
directory? = $(if $(1),$(call boolean,$(wildcard $(addsuffix /.,$(1)))))

# Determines whether the given path exists and is a file.
# Files are defined as everything that is not a directory.
#
# Arguments:
#   $(1) = path to check
#
# Returns:
#   whether $(1) refers to an existing file
#
file? = $(call boolean,$(and $(wildcard $(1)),$(call not,$(call directory?,$(1)))))

# Returns a sorted list of unique paths matching the specified pattern.
#
# Arguments:
#   $(1) = pattern entries must match
#
# Defaults:
#   $(1) = *
#
# Returns:
#   list of paths matching $(1)
#
glob = $(sort $(wildcard $(or $(1),$(glob.default))))

# By default, glob with match everything except hidden files in the current directory.
glob.default := *

# Returns a sorted list of unique paths inside the specified directory
# that match the specified pattern.
#
# Arguments:
#   $(1) = list of directories to work with
#   $(2) = pattern entries must match
#
# Defaults:
#   $(1) = .
#   $(2) = *
#
# Returns:
#   list of paths in $(1) matching $(2)
#
# Example:
#
#   # Enumerates all entries in the current directory.
#   $(call glob.directory)
#
# Example:
#
#   # Enumerates all entries in the current directory that start with ".git".
#   $(call glob.directory,,.git*)
#
glob.directory = $(call glob,$(addsuffix /$(or $(2),$(glob.default)),$(or $(1),$(glob.directory.default))))

# By default, glob.directory operates on the current directory.
glob.directory.default := .

# Traverses the file system recursively.
#
# Arguments:
#   $(1) = starting directory
#
# Defaults:
#   $(1) = .
#
# Returns:
#   list with the contents of the tree rooted in $(1)
#
file_system.traverse = $(call recurse,glob.directory,file?,$(or $(1),$(file_system.traverse.default)))

# By default, file_system.traverse operates on the current directory.
file_system.traverse.default := .

# Walks the directory and returns all files satisfying the predicate function.
# Behaves just like file_system.traverse if not given a predicate function.
#
# Arguments:
#   $(1) = starting directory
#   $(2) = optional predicate function
#
# Defaults:
#   $(1) = .
#   $(2) = true
#
# Returns:
#   list containing paths in $(1) that satisfy $(2)
#
# Example:
#
#   # Find all source files.
#   $(call find,source,file?)
#
find = $(strip $(foreach entry,$(call file_system.traverse,$(1)),$(if $(call $(or $(2),true),$(entry)),$(entry))))
